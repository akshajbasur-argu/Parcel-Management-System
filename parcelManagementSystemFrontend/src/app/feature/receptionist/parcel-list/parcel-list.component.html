<div class="max-w-6xl mx-auto mt-12 px-4 animate-fade-in">
  <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">ðŸ“¦ Active Parcel List</h2>
 <div class="flex justify-end mb-4">
      <mat-form-field appearance="fill" class="w-full md:w-1/3">
        <mat-label>Search user</mat-label>
        <input
          matInput
          type="text"
          [(ngModel)]="searchTerm"
          (keyup)="onSearch()"
          placeholder="Type recipient name..."
        />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>
  <div class="overflow-x-auto">
      <table class="w-full border border-gray-200 rounded-lg shadow-sm">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2 text-center text-sm font-medium text-gray-600">ID</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Name</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Name on Parcel</th>
            <!-- <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Description</th> -->
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Shortcode</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Time</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Status</th>
            <th class="px-4 py-2 text-center text-sm font-medium text-gray-600">Action</th>
          </tr>
        </thead>
        <tbody>
          @for (parcel of filteredparcels; track parcel.id) {
          <tr class="border-t hover:bg-gray-50">
            <td class="px-4 py-2 text-sm text-center text-gray-700">{{ parcel.id }}</td>
            <td class="px-4 py-2 text-sm text-gray-700">{{ parcel.recipientName }}</td>
            <td class="px-4 py-2 text-sm text-gray-700">{{ parcel.parcelName }}</td>
            <!-- <td class="px-4 py-2 text-sm text-gray-700">{{ parcel.description }}</td> -->
            <td class="px-4 py-2 text-sm text-gray-700">{{ parcel.shortcode }}</td>
            <td class="px-4 py-2 text-sm text-gray-700">
              {{ parcel.createdAt | date : 'MM/dd/yyyy HH:mm' }}
            </td>
            <td class="px-4 py-2 text-sm text-gray-700">
              <span
                class="px-2 py-1 rounded-full text-xs font-medium"
                [ngClass]="{
                  'bg-green-100 text-green-700': parcel.status === 'PICKED_UP',
                  'bg-yellow-100 text-yellow-700': parcel.status === 'RECEIVED'
                }"
              >
                {{ parcel.status }}
              </span>
            </td>
            <td class="px-4 py-2 text-sm text-gray-700">
              <div class="flex justify-center gap-2">
                <button
                  mat-raised-button
                  color="primary"
                  class="text-xs"
                  (click)="validate(parcel)"
                >
                  Validate OTP
                </button>
                <button
                  mat-raised-button
                  [disabled]="loading === parcel.id"
                  color="accent"
                  class="text-xs rounded-[0px]"
                  (click)="resend(parcel.id)"
                >
                  {{ loading === parcel.id ? 'Loading...' : 'Resend OTP' }}
                </button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Popup -->
    @if (showPopup) {
    <div
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
      (click)="closePopup()"
    >
      <div
        class="bg-white p-6 rounded-lg shadow-2xl w-[90%] sm:w-[400px] animate-fade-in"
        (click)="$event.stopPropagation()"
      >
        <h2 class="text-xl font-semibold mb-4 text-gray-800">
          Enter OTP for {{ selecteditem.recipientName }}
        </h2>

        <mat-form-field appearance="fill" class="w-full mb-4">
          <mat-label>Enter OTP</mat-label>
          <input matInput [(ngModel)]="popupData.otp" placeholder="Enter value" />
        </mat-form-field>

        <div class="flex justify-end space-x-2">
          <button mat-stroked-button color="warn" (click)="closePopup()">Cancel</button>
          <button mat-flat-button color="primary" (click)="submitPopup(selecteditem.id)">
            Save
          </button>
        </div>
      </div>
    </div>
    }

    <!-- Paginator -->
    <div class="mt-6">
      <mat-paginator
        [length]="length"
        [pageSize]="10"
        (page)="onPageChange($event)"
        aria-label="Select page"
      ></mat-paginator>
    </div>
</div>
