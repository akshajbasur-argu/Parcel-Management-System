<div class="max-w-7xl mx-auto mt-12 px-4 animate-fade-in">
  
  <!-- Header -->
  <h2 class="text-3xl font-bold mb-6 text-gray-800">ðŸ‘¥ User List</h2>

  <!-- Search Bar and Action Button -->
  <div class="mb-6 flex flex-col md:flex-row justify-between items-stretch md:items-center gap-4">
    <mat-form-field appearance="fill" class="w-full md:w-auto md:min-w-[320px]">
      <mat-label>Search user</mat-label>
      <input
        matInput
        type="text"
        [(ngModel)]="searchTerm"
        (keyup)="onSearch()"
        placeholder="Type user name or email..."
      />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <button
      mat-raised-button
      color="primary"
      class="!bg-[#903564] !text-gray-50 disabled:!bg-gray-300 w-full md:w-auto"
      (click)="openNotificationPopup()"
      [disabled]="selectedUserIds.length === 0"
    >
      Send Notification ({{ selectedUserIds.length }})
    </button>
  </div>

  <!-- Table Container -->
  <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
    
    <!-- Desktop Table View -->
    <div class="hidden md:block overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 lg:px-6 py-3 text-center text-xs lg:text-sm font-semibold text-gray-600">
              <input 
                type="checkbox" 
                (change)="toggleSelectAll($event)"
                class="cursor-pointer"
              />
            </th>
            <th class="px-4 lg:px-6 py-3 text-center text-xs lg:text-sm font-semibold text-gray-600">ID</th>
            <th class="px-4 lg:px-6 py-3 text-left text-xs lg:text-sm font-semibold text-gray-600">Name</th>
            <th class="px-4 lg:px-6 py-3 text-left text-xs lg:text-sm font-semibold text-gray-600">Email</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          @for (user of filteredusers; track user.id) {
            <tr class="hover:bg-gray-50 transition-all duration-150">
              <td class="px-4 lg:px-6 py-3 text-center">
                <input
                  type="checkbox"
                  [checked]="selectedUserIds.includes(user.id)"
                  (change)="toggleUserSelection(user.id, $event)"
                  class="cursor-pointer"
                />
              </td>
              <td class="px-4 lg:px-6 py-3 text-sm text-center text-gray-700">{{ user.id }}</td>
              <td class="px-4 lg:px-6 py-3 text-sm text-gray-800 font-medium">{{ user.name }}</td>
              <td class="px-1 lg:px-6 py-3 text-sm text-gray-700">{{ user.email }}</td>
            </tr>
          }
          @empty {
            <tr>
              <td colspan="4" class="px-6 py-8 text-center text-gray-500">
                <div class="flex flex-col items-center gap-2">
                  <span class="text-4xl text-gray-300">ðŸ‘¥</span>
                  <p>No users found</p>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Mobile Card View -->
<div class="md:hidden divide-y divide-gray-200">

  @for (user of filteredusers; track user.id) {

    <div 
      class="p-4 hover:bg-gray-50 transition-all duration-150 cursor-pointer"
      (click)="toggleUserCard(user.id)"
    >

      <div class="flex items-center justify-between mb-2">

  <!-- Left Side: ID -->
  <span class="bg-gray-200 text-gray-700 font-bold text-xs rounded-full px-2 py-1">
    ID: {{ user.id }}
  </span>

  <!-- Right Side: Checkbox -->
  <input
    type="checkbox"
    class="w-4 h-4 pointer-events-none"
    [checked]="selectedUserIds.includes(user.id)"
  />

</div>

      <h3 class="font-semibold text-gray-800 text-base mb-2">
        {{ user.name }}
      </h3>

      <!-- Email-->
      <div class="text-sm flex">
        <span class="text-gray-500 font-medium mr-2">Email:</span>
        <span class="text-gray-700 truncate w-full">
          {{ user.email }}
        </span>
      </div>

    </div>

  } @empty {

    <div class="p-8 text-center">
      <div class="text-gray-400 text-5xl mb-4">ðŸ‘¥</div>
      <h3 class="text-lg font-semibold text-gray-700 mb-2">No Users</h3>
      <p class="text-gray-500 text-sm">Try adjusting your search criteria.</p>
    </div>

  }

</div>


  </div>

  <!-- Notification Popup -->
  @if (showPopup) {
    <div
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
      (click)="closePopup()"
    >
      <div
        class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-md animate-fade-in"
        (click)="$event.stopPropagation()"
      >
        <h2 class="text-xl font-semibold mb-4 text-gray-800">
          Send Notification
        </h2>
        <p class="text-sm text-gray-600 mb-4">
          Sending to {{ selectedUserIds.length }} selected user(s)
        </p>

        <form #notifyForm="ngForm" (ngSubmit)="confirmNotification()">
          <mat-form-field appearance="fill" class="w-full mb-4">
            <mat-label>Company</mat-label>
            <input
              matInput
              type="text"
              name="company"
              [(ngModel)]="notificationData.company"
              placeholder="Enter company name"
              required
            />
          </mat-form-field>

          <mat-form-field appearance="fill" class="w-full mb-4">
            <mat-label>Order ID</mat-label>
            <input
              matInput
              type="text"
              name="orderId"
              [(ngModel)]="notificationData.orderId"
              placeholder="Enter order ID"
              required
            />
          </mat-form-field>

          <div class="flex flex-col sm:flex-row justify-end gap-2">
            <button 
              mat-stroked-button 
              color="warn" 
              type="button"
              (click)="closePopup()"
              class="w-full sm:w-auto"
            >
              Cancel
            </button>
            <button 
              mat-flat-button 
              color="primary"
              type="submit"
              [disabled]="notifyForm.invalid"
              class="w-full sm:w-auto !bg-[#903564]"
            >
              Send Notification
            </button>
          </div>
        </form>
      </div>
    </div>
  }

    <!-- Pagination -->
  <div class="mt-6">
    <mat-paginator
  [length]="length"
  [pageSize]="pageSize"
  [pageIndex]="pageIndex"
  [pageSizeOptions]="[2, 5, 10]"
  (page)="onPageChange($event)"
  aria-label="Select page"
></mat-paginator>

  </div>
</div>

